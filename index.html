<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ í•™êµ ìƒí™œ ë§¤ë‹ˆì €</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (ì•„ì´ì½˜) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; margin-bottom: 1rem; }
    </style>
</head>
<body class="text-gray-800">

    <!-- ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden">
        
        <!-- í—¤ë” (í•™ìƒ ë¡œê·¸ì¸ ì‹œì—ë§Œ ìƒë‹´/í¬ì¸íŠ¸ ë²„íŠ¼ í‘œì‹œ) -->
        <header id="main-header" class="bg-blue-600 text-white p-4 flex justify-between items-center hidden sticky top-0 z-50">
            <h1 class="text-lg font-bold cursor-pointer" onclick="app.goHome()">ğŸ« ìŠ¤ì¿¨ ë¼ì´í”„</h1>
            <div class="flex gap-2">
                <div id="student-header-controls" class="hidden flex gap-2">
                    <span class="bg-blue-800 px-2 py-1 rounded text-sm flex items-center">
                        <i class="fas fa-coins text-yellow-300 mr-1"></i> <span id="header-points">0</span> P
                    </span>
                    <button onclick="app.requestConsultation()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded text-sm font-bold shadow">
                        <i class="fas fa-comments mr-1"></i>ìƒë‹´ì‹ ì²­
                    </button>
                </div>
                <button onclick="app.logout()" class="text-xs bg-blue-800 hover:bg-blue-700 px-2 py-1 rounded">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>

        <!-- 1. ë¡œê·¸ì¸ í˜ì´ì§€ -->
        <div id="page-login" class="page active p-8 flex flex-col justify-center min-h-screen bg-blue-50">
            <div class="text-center mb-10">
                <i class="fas fa-school text-6xl text-blue-600 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800">í•™êµ ìƒí™œ ë§¤ë‹ˆì €</h1>
                <p class="text-gray-500 mt-2">í•¨ê»˜ ì„±ì¥í•˜ëŠ” ìš°ë¦¬ í•™êµ</p>
            </div>

            <div class="space-y-4">
                <button onclick="app.showLoginForm('student')" class="w-full bg-white border-2 border-blue-500 text-blue-600 p-4 rounded-xl font-bold text-lg hover:bg-blue-50 transition shadow-md flex items-center justify-center gap-2">
                    <i class="fas fa-user-graduate"></i> í•™ìƒ / êµì‚¬ ë¡œê·¸ì¸
                </button>
                <button onclick="app.showAdminLogin()" class="w-full bg-gray-800 text-white p-4 rounded-xl font-bold text-lg hover:bg-gray-700 transition shadow-md flex items-center justify-center gap-2">
                    <i class="fas fa-user-shield"></i> ê´€ë¦¬ì ë¡œê·¸ì¸
                </button>
            </div>

            <!-- ë¡œê·¸ì¸ í¼ ëª¨ë‹¬ -->
            <div id="login-form-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white p-6 rounded-xl w-80 shadow-2xl">
                    <h2 id="login-title" class="text-xl font-bold mb-4 text-center">ë¡œê·¸ì¸</h2>
                    <input type="text" id="login-id" placeholder="ì•„ì´ë””" class="w-full border p-2 rounded mb-2">
                    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-2 rounded mb-4">
                    <button onclick="app.processLogin()" class="w-full bg-blue-600 text-white p-2 rounded font-bold">ì ‘ì†í•˜ê¸°</button>
                    <button onclick="document.getElementById('login-form-modal').classList.add('hidden')" class="w-full mt-2 text-gray-500 text-sm">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <!-- 2. ê´€ë¦¬ì í˜ì´ì§€ -->
        <div id="page-admin" class="page p-4">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">ğŸ›¡ï¸ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h2>
            
            <!-- ê³„ì • ìƒì„± -->
            <div class="card">
                <h3 class="font-bold text-lg mb-3">ê³„ì • ë°œê¸‰ ë° ë°°ì •</h3>
                <div class="space-y-2">
                    <select id="create-role" class="w-full border p-2 rounded" onchange="app.toggleTeacherSelect()">
                        <option value="student">í•™ìƒ</option>
                        <option value="teacher">êµì‚¬</option>
                    </select>
                    <input type="text" id="create-name" placeholder="ì´ë¦„" class="w-full border p-2 rounded">
                    <input type="text" id="create-id" placeholder="ì•„ì´ë””" class="w-full border p-2 rounded">
                    <input type="password" id="create-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-2 rounded">
                    <select id="assign-teacher" class="w-full border p-2 rounded">
                        <option value="">ë‹´ë‹¹ êµì‚¬ ì„ íƒ</option>
                        <!-- JSë¡œ êµì‚¬ ëª©ë¡ ë¡œë“œ -->
                    </select>
                    <button onclick="app.createUser()" class="w-full bg-green-600 text-white p-2 rounded font-bold hover:bg-green-700">ê³„ì • ìƒì„±</button>
                </div>
            </div>

            <!-- í•™ì‚¬ ì¼ì •/í‰ê°€ ì—…ë¡œë“œ -->
            <div class="card">
                <h3 class="font-bold text-lg mb-3">í•™ì‚¬ ì¼ì • ë° ìˆ˜í–‰í‰ê°€ ë“±ë¡</h3>
                <div class="border-2 border-dashed border-gray-300 p-6 rounded text-center cursor-pointer hover:bg-gray-50" onclick="document.getElementById('admin-file').click()">
                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                    <p class="text-sm text-gray-500">ëª¨ë“  íŒŒì¼ í˜•ì‹ ì§€ì›</p>
                    <input type="file" id="admin-file" class="hidden" onchange="alert('íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.')">
                </div>
                <div class="mt-2">
                    <input type="text" id="notice-content" placeholder="ì¼ì • ë‚´ìš© ì…ë ¥" class="w-full border p-2 rounded mb-2">
                    <input type="date" id="notice-date" class="w-full border p-2 rounded mb-2">
                    <button onclick="app.addNotice()" class="w-full bg-blue-500 text-white p-2 rounded">ì¼ì • ë“±ë¡</button>
                </div>
            </div>
        </div>

        <!-- 3. êµì‚¬ í˜ì´ì§€ -->
        <div id="page-teacher" class="page p-4">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 border-b pb-2">ğŸ‘¨â€ğŸ« êµë¬´ì‹¤</h2>

            <!-- ì™¸ë¶€ ë§í¬ ë²„íŠ¼ -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <button onclick="alert('ëŒ€í•œë¯¼êµ­ ì¥í•™ ì¬ë‹¨ ë° ì‹œë„ êµìœ¡ì²­ ì¥í•™ ì‚¬ì—… í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.')" class="bg-indigo-100 text-indigo-700 p-3 rounded-xl font-bold text-sm text-center hover:bg-indigo-200">
                    <i class="fas fa-graduation-cap block text-xl mb-1"></i>ì¥í•™ ì‚¬ì—…
                </button>
                <a href="tel:16008272" class="bg-green-100 text-green-700 p-3 rounded-xl font-bold text-sm text-center hover:bg-green-200">
                    <i class="fas fa-phone-alt block text-xl mb-1"></i>ê²½ê¸°ë„ ì˜¨ì½œ
                    <div class="text-xs font-normal">1600-8272</div>
                </a>
            </div>

            <!-- íŒŒì¼ ì—…ë¡œë“œ -->
            <div class="card">
                <h3 class="font-bold text-gray-700 mb-2">ğŸ“‚ í•™ìŠµ ìë£Œ/í‰ê°€ ì—…ë¡œë“œ</h3>
                <input type="file" class="block w-full text-sm text-slate-500
                  file:mr-4 file:py-2 file:px-4
                  file:rounded-full file:border-0
                  file:text-sm file:font-semibold
                  file:bg-violet-50 file:text-violet-700
                  hover:file:bg-violet-100
                " onchange="alert('ìë£Œê°€ ì—…ë¡œë“œ ë˜ì—ˆìŠµë‹ˆë‹¤.')"/>
            </div>

            <!-- ê´€ë¦¬ í•™ìƒ ëª©ë¡ -->
            <h3 class="font-bold text-lg mb-2 mt-6">ğŸ“‹ ìš°ë¦¬ ë°˜ í•™ìƒ ê´€ë¦¬</h3>
            <div id="student-list" class="space-y-3">
                <!-- JSë¡œ ë Œë”ë§ -->
            </div>
        </div>

        <!-- 4. í•™ìƒ ë©”ì¸ í˜ì´ì§€ (Page 2) -->
        <div id="page-student-main" class="page p-4 pb-20">
            <!-- ì˜¤ëŠ˜ì˜ ë‹¨ì–´/ë¬¸ì¥ -->
            <div class="bg-gradient-to-r from-blue-500 to-indigo-600 rounded-2xl p-5 text-white shadow-lg mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 -mt-2 -mr-2 w-16 h-16 bg-white opacity-20 rounded-full"></div>
                <h3 class="text-sm font-semibold opacity-80 mb-1">Today's Pick</h3>
                <p id="today-word" class="text-2xl font-bold mb-1">Serendipity</p>
                <p id="today-meaning" class="text-sm opacity-90">ëœ»ë°–ì˜ ê¸°ì¨</p>
            </div>

            <!-- ì¸ì„± êµìœ¡ ëª…ì–¸ -->
            <div class="card border-l-4 border-yellow-400">
                <h3 class="text-sm font-bold text-gray-400 mb-1"><i class="fas fa-quote-left mr-1"></i>ì˜¤ëŠ˜ì˜ ì¢‹ì€ ë§</h3>
                <p id="today-quote" class="text-gray-700 font-medium italic">"ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤. ê¿ˆì„ í–¥í•´ ë‚˜ì•„ê°€ë¼."</p>
            </div>

            <!-- í•™ì‚¬ ì¼ì • & D-DAY -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-lg">ğŸ“… í•™ì‚¬ ë° í‰ê°€ ì¼ì •</h3>
                    <span class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded-full">D-Day</span>
                </div>
                <ul id="schedule-list" class="space-y-3 text-sm">
                    <!-- JS ë¡œë“œ -->
                </ul>
            </div>

            <!-- ë‹¤ìŒ í˜ì´ì§€ ì´ë™ ë²„íŠ¼ -->
            <button onclick="app.goToDailyLog()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg text-lg flex items-center justify-center gap-2 transform transition hover:scale-105">
                âœï¸ ì•Œì°¬ ë‚˜ì˜ í•˜ë£¨ ê¸°ë¡í•˜ê¸° <i class="fas fa-arrow-right"></i>
            </button>
        </div>

        <!-- 5. í•™ìƒ ë°ì¼ë¦¬ ë¡œê·¸ (Page 3) -->
        <div id="page-student-log" class="page p-4 pb-20">
            <div class="flex items-center mb-6">
                <button onclick="app.showPage('student-main')" class="mr-3 text-gray-500 hover:text-gray-800"><i class="fas fa-arrow-left text-xl"></i></button>
                <h2 class="text-2xl font-bold">ğŸ“ ì•Œì°¬ ë‚˜ì˜ í•˜ë£¨</h2>
            </div>

            <!-- ì‹ë‹¨ ê¸°ë¡ -->
            <div class="card">
                <h3 class="font-bold text-gray-800 mb-3"><i class="fas fa-utensils text-orange-500 mr-2"></i>ì˜¤ëŠ˜ ë¨¹ì€ ìŒì‹</h3>
                <div class="grid gap-3">
                    <div>
                        <label class="text-xs text-gray-500">ì•„ì¹¨</label>
                        <input type="text" id="food-morning" placeholder="ì˜ˆ: ì‹œë¦¬ì–¼, ìš°ìœ " class="w-full border p-2 rounded bg-gray-50">
                    </div>
                    <div>
                        <label class="text-xs text-gray-500">ì €ë…</label>
                        <input type="text" id="food-dinner" placeholder="ì˜ˆ: ê¹€ì¹˜ì°Œê°œ, ë°¥" class="w-full border p-2 rounded bg-gray-50">
                    </div>
                </div>
            </div>

            <!-- ìš´ë™ ê¸°ë¡ -->
            <div class="card">
                <h3 class="font-bold text-gray-800 mb-3"><i class="fas fa-running text-green-500 mr-2"></i>ì˜¤ëŠ˜ì˜ ìš´ë™</h3>
                <div class="flex gap-2 mb-2">
                    <input type="text" id="exercise-type" placeholder="ìš´ë™ ì¢…ë¥˜ (ì˜ˆ: ì¤„ë„˜ê¸°)" class="w-2/3 border p-2 rounded">
                    <input type="number" id="exercise-time" placeholder="ë¶„" class="w-1/3 border p-2 rounded">
                </div>
            </div>

            <!-- íœ´ëŒ€í° ì‚¬ìš© ì‹œê°„ -->
            <div class="card">
                <h3 class="font-bold text-gray-800 mb-3"><i class="fas fa-mobile-alt text-blue-500 mr-2"></i>íœ´ëŒ€ì „í™” ì‚¬ìš© ì‹œê°„</h3>
                <select id="phone-usage" class="w-full border p-2 rounded mb-3 text-lg" onchange="app.checkPhoneUsage()">
                    <option value="">ì‹œê°„ ì„ íƒ</option>
                    <!-- JSë¡œ 30ë¶„ ë‹¨ìœ„ ìƒì„± -->
                </select>
                <div id="phone-feedback" class="hidden p-3 rounded-lg text-sm font-bold text-center animate-pulse"></div>
            </div>

            <!-- ì œì¶œ ë²„íŠ¼ -->
            <button onclick="app.submitDailyLog()" class="w-full bg-indigo-600 text-white p-4 rounded-xl font-bold text-lg shadow-lg">
                ê¸°ë¡ ì™„ë£Œí•˜ê³  ì €ì¥ âœ¨
            </button>
        </div>

        <!-- í•™ìƒ ìƒì„¸ ì •ë³´ ëª¨ë‹¬ (êµì‚¬ìš©) -->
        <div id="student-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto">
            <div class="min-h-screen px-4 text-center">
                <span class="inline-block h-screen align-middle" aria-hidden="true">&#8203;</span>
                <div class="inline-block w-full max-w-md p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl rounded-2xl relative">
                    <button onclick="document.getElementById('student-detail-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                    <h3 id="modal-student-name" class="text-2xl font-bold mb-1">í•™ìƒ ì´ë¦„</h3>
                    <p class="text-gray-500 text-sm mb-4">í™œë™ ëŒ€ì‹œë³´ë“œ</p>
                    
                    <div class="grid grid-cols-2 gap-2 mb-4">
                        <div class="bg-blue-50 p-3 rounded text-center">
                            <div class="text-xs text-gray-500">ëˆ„ì  í¬ì¸íŠ¸</div>
                            <div id="modal-points" class="text-xl font-bold text-blue-600">0 P</div>
                        </div>
                        <div class="bg-green-50 p-3 rounded text-center">
                            <div class="text-xs text-gray-500">ì´ë²ˆ ë‹¬ ê¸°ë¡</div>
                            <div id="modal-log-count" class="text-xl font-bold text-green-600">0 íšŒ</div>
                        </div>
                    </div>

                    <h4 class="font-bold text-sm mb-2">ìµœê·¼ í™œë™ ë¡œê·¸</h4>
                    <div id="modal-logs" class="bg-gray-50 p-3 rounded h-40 overflow-y-auto text-sm space-y-2 mb-4">
                        <!-- ë¡œê·¸ ë‚´ìš© -->
                    </div>

                    <button id="modal-warn-btn" class="w-full bg-red-100 text-red-600 font-bold py-2 rounded hover:bg-red-200" onclick="app.sendWarning()">
                        <i class="fas fa-bell mr-1"></i>í™œë™ ë…ë ¤ ì•Œë¦¼ ë³´ë‚´ê¸°
                    </button>
                </div>
            </div>
        </div>

    </div>

<script>
// ë°ì´í„° ë° ì•± ë¡œì§
const app = {
    data: {
        currentUser: null,
        users: [
            { id: 'teacher1', pw: '1234', name: 'ê¹€êµì‚¬', role: 'teacher', students: [] },
            { id: 'student1', pw: '1234', name: 'ì´í•™ìƒ', role: 'student', teacherId: 'teacher1', points: 150, avgPhone: 180, logs: [], lastActive: Date.now() },
            { id: 'student2', pw: '1234', name: 'ë°•í•™ìƒ', role: 'student', teacherId: 'teacher1', points: 20, avgPhone: 180, logs: [], lastActive: Date.now() - 864000000 } // ì˜¤ë«ë™ì•ˆ í™œë™ ì•ˆí•¨
        ],
        schedules: [
            { date: '2026-03-02', title: 'ê°œí•™ì‹', type: 'event' },
            { date: '2026-03-25', title: 'ì˜ì–´ ë§í•˜ê¸° ìˆ˜í–‰í‰ê°€', type: 'exam' },
            { date: '2026-04-05', title: 'ìˆ˜í•™ ìª½ì§€ì‹œí—˜', type: 'exam' }
        ],
        words: [
            { word: 'Perseverance', mean: 'ì¸ë‚´ì‹¬' },
            { word: 'Integrity', mean: 'ì§„ì‹¤ì„±' },
            { word: 'Empathy', mean: 'ê³µê°' }
        ],
        quotes: [
            "ì²œë¦¬ ê¸¸ë„ í•œ ê±¸ìŒë¶€í„°.",
            "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆì´ë‹¤.",
            "ë„ˆ ìì‹ ì„ ì•Œë¼."
        ]
    },

    init: function() {
        this.renderPhoneOptions();
        
        // localStorageì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹œë„ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
        const savedUsers = localStorage.getItem('schoolAppUsers');
        if (savedUsers) this.data.users = JSON.parse(savedUsers);
        
        const savedSchedules = localStorage.getItem('schoolAppSchedules');
        if (savedSchedules) this.data.schedules = JSON.parse(savedSchedules);
    },

    saveData: function() {
        localStorage.setItem('schoolAppUsers', JSON.stringify(this.data.users));
        localStorage.setItem('schoolAppSchedules', JSON.stringify(this.data.schedules));
    },

    // í™”ë©´ ì „í™˜ ìœ í‹¸ë¦¬í‹°
    showPage: function(pageId) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        
        const header = document.getElementById('main-header');
        if(pageId === 'login') {
            header.classList.add('hidden');
        } else {
            header.classList.remove('hidden');
        }
    },

    // ë¡œê·¸ì¸ ê´€ë ¨
    showAdminLogin: function() {
        const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (íŒíŠ¸: 1234)");
        if (pw === '1234') {
            this.data.currentUser = { role: 'admin', name: 'ê´€ë¦¬ì' };
            this.renderAdmin();
            this.showPage('admin');
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
    },

    showLoginForm: function() {
        document.getElementById('login-form-modal').classList.remove('hidden');
        document.getElementById('login-id').value = '';
        document.getElementById('login-pw').value = '';
    },

    processLogin: function() {
        const id = document.getElementById('login-id').value;
        const pw = document.getElementById('login-pw').value;
        
        const user = this.data.users.find(u => u.id === id && u.pw === pw);
        
        if (user) {
            this.data.currentUser = user;
            document.getElementById('login-form-modal').classList.add('hidden');
            if (user.role === 'teacher') {
                this.renderTeacher();
                this.showPage('teacher');
            } else {
                this.renderStudentMain();
                this.showPage('student-main');
            }
        } else {
            alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    },

    logout: function() {
        this.data.currentUser = null;
        this.showPage('login');
    },

    goHome: function() {
        if (!this.data.currentUser) return;
        if (this.data.currentUser.role === 'admin') this.showPage('admin');
        else if (this.data.currentUser.role === 'teacher') this.showPage('teacher');
        else this.showPage('student-main');
    },

    // ê´€ë¦¬ì ê¸°ëŠ¥
    renderAdmin: function() {
        // êµì‚¬ ì„ íƒ ì˜µì…˜ ë Œë”ë§
        const teacherSelect = document.getElementById('assign-teacher');
        teacherSelect.innerHTML = '<option value="">ë‹´ë‹¹ êµì‚¬ ì„ íƒ</option>';
        this.data.users.filter(u => u.role === 'teacher').forEach(t => {
            teacherSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
        });
    },

    toggleTeacherSelect: function() {
        const role = document.getElementById('create-role').value;
        const teacherSelect = document.getElementById('assign-teacher');
        teacherSelect.style.display = role === 'student' ? 'block' : 'none';
    },

    createUser: function() {
        const role = document.getElementById('create-role').value;
        const name = document.getElementById('create-name').value;
        const id = document.getElementById('create-id').value;
        const pw = document.getElementById('create-pw').value;
        const teacherId = document.getElementById('assign-teacher').value;

        if (!name || !id || !pw) return alert("ëª¨ë“  ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        if (role === 'student' && !teacherId) return alert("í•™ìƒì€ ë‹´ë‹¹ êµì‚¬ë¥¼ ë°°ì •í•´ì•¼ í•©ë‹ˆë‹¤.");

        // ì•„ì´ë”” ì¤‘ë³µ ì²´í¬
        if(this.data.users.some(u => u.id === id)) return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.");

        const newUser = {
            id, pw, name, role,
            ...(role === 'student' ? { teacherId, points: 0, avgPhone: 180, logs: [], lastActive: Date.now() } : { students: [] })
        };

        this.data.users.push(newUser);
        this.saveData();
        alert(`${role === 'student' ? 'í•™ìƒ' : 'êµì‚¬'} ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        
        // í¼ ì´ˆê¸°í™”
        document.getElementById('create-name').value = '';
        document.getElementById('create-id').value = '';
        document.getElementById('create-pw').value = '';
    },

    addNotice: function() {
        const content = document.getElementById('notice-content').value;
        const date = document.getElementById('notice-date').value;
        if(!content || !date) return alert('ë‚´ìš©ê³¼ ë‚ ì§œë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

        this.data.schedules.push({ date: date, title: content, type: 'event' });
        this.saveData();
        alert('ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('notice-content').value = '';
    },

    // êµì‚¬ ê¸°ëŠ¥
    renderTeacher: function() {
        const list = document.getElementById('student-list');
        list.innerHTML = '';
        
        const myStudents = this.data.users.filter(u => u.role === 'student' && u.teacherId === this.data.currentUser.id);

        if (myStudents.length === 0) {
            list.innerHTML = '<p class="text-gray-500 text-center">ë°°ì •ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        myStudents.forEach(s => {
            // í™œë™ ë¯¸í¡ ì²´í¬ (ë§ˆì§€ë§‰ í™œë™ì´ 7ì¼ ì´ìƒ ì§€ë‚¬ì„ ë•Œ)
            const isInactive = (Date.now() - (s.lastActive || 0)) > (7 * 24 * 60 * 60 * 1000);
            const warningBadge = isInactive ? `<span class="text-xs bg-red-100 text-red-600 px-1 rounded ml-2 animate-pulse">âš ï¸ í™œë™ ë¯¸í¡</span>` : '';

            const div = document.createElement('div');
            div.className = 'bg-white p-4 rounded-lg shadow border-l-4 border-blue-500 flex justify-between items-center cursor-pointer hover:bg-gray-50 transition';
            div.innerHTML = `
                <div>
                    <span class="font-bold text-lg">${s.name}</span>
                    <span class="text-sm text-gray-500 ml-2">(${s.id})</span>
                    ${warningBadge}
                </div>
                <div class="text-right">
                    <div class="text-sm font-bold text-blue-600">${s.points} P</div>
                </div>
            `;
            div.onclick = () => this.showStudentDetail(s.id);
            list.appendChild(div);
        });
    },

    showStudentDetail: function(studentId) {
        const student = this.data.users.find(u => u.id === studentId);
        if (!student) return;

        document.getElementById('modal-student-name').innerText = student.name;
        document.getElementById('modal-points').innerText = `${student.points} P`;
        
        // ì´ë²ˆë‹¬ ë¡œê·¸ ìˆ˜ ê³„ì‚°
        const thisMonth = new Date().getMonth();
        const monthlyLogs = student.logs.filter(l => new Date(l.date).getMonth() === thisMonth).length;
        document.getElementById('modal-log-count').innerText = `${monthlyLogs} íšŒ`;

        // ë¡œê·¸ ë Œë”ë§
        const logsDiv = document.getElementById('modal-logs');
        logsDiv.innerHTML = student.logs.length ? '' : '<div class="text-center text-gray-400">í™œë™ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        
        // ìµœê·¼ 5ê°œë§Œ
        [...student.logs].reverse().slice(0, 5).forEach(log => {
            logsDiv.innerHTML += `
                <div class="border-b pb-1 mb-1 last:border-0">
                    <span class="text-xs text-gray-400">${new Date(log.date).toLocaleDateString()}</span><br>
                    <span class="text-xs">ğŸ’ª ${log.exerciseType} (${log.exerciseTime}ë¶„)</span>
                </div>
            `;
        });

        // ê²½ê³  ë²„íŠ¼ ì„¸íŒ… (ë¯¸í™œë™ ì‹œì—ë§Œ ìœ íš¨í•œ ì‹œë‚˜ë¦¬ì˜¤ì§€ë§Œ, í¸ì˜ìƒ í•­ìƒ ë„ìš°ê³  ë¯¸í™œë™ìì—ê²Œ ë³´ë‚¼ ë•Œ ì•¡ì…˜)
        const warnBtn = document.getElementById('modal-warn-btn');
        warnBtn.onclick = () => {
            alert(`${student.name} í•™ìƒì—ê²Œ í™œë™ ë…ë ¤ ì•Œë¦¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤! ğŸ””`);
        };

        document.getElementById('student-detail-modal').classList.remove('hidden');
    },

    // í•™ìƒ ê¸°ëŠ¥
    renderStudentMain: function() {
        const studentControls = document.getElementById('student-header-controls');
        studentControls.classList.remove('hidden');
        document.getElementById('header-points').innerText = this.data.currentUser.points;

        // ì˜¤ëŠ˜ì˜ ë‹¨ì–´/ëª…ì–¸ (ëœë¤)
        const word = this.data.words[Math.floor(Math.random() * this.data.words.length)];
        document.getElementById('today-word').innerText = word.word;
        document.getElementById('today-meaning').innerText = word.mean;
        document.getElementById('today-quote').innerText = `"${this.data.quotes[Math.floor(Math.random() * this.data.quotes.length)]}"`;

        // ì¼ì • ë Œë”ë§
        const scheduleList = document.getElementById('schedule-list');
        scheduleList.innerHTML = '';
        const today = new Date();
        
        // ë‚ ì§œìˆœ ì •ë ¬
        const sortedSchedules = this.data.schedules.sort((a, b) => new Date(a.date) - new Date(b.date));

        sortedSchedules.forEach(sch => {
            const schDate = new Date(sch.date);
            const diffTime = schDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            let ddayText = '';
            if (diffDays === 0) ddayText = "D-Day";
            else if (diffDays > 0) ddayText = `D-${diffDays}`;
            else return; // ì§€ë‚œ ì¼ì •ì€ ìˆ¨ê¹€ (ì˜µì…˜)

            const icon = sch.type === 'exam' ? 'ğŸ“' : 'ğŸ“Œ';
            const colorClass = sch.type === 'exam' ? 'text-red-600 font-bold' : 'text-gray-700';

            scheduleList.innerHTML += `
                <li class="flex justify-between border-b pb-2 last:border-0">
                    <span class="${colorClass}">${icon} ${sch.title} <span class="text-xs text-gray-400 ml-1">${sch.date}</span></span>
                    <span class="bg-gray-200 text-gray-700 px-2 rounded text-xs flex items-center">${ddayText}</span>
                </li>
            `;
        });
    },

    requestConsultation: function() {
        const teacher = this.data.users.find(u => u.id === this.data.currentUser.teacherId);
        const teacherName = teacher ? teacher.name : "ë‹´ì„ êµì‚¬";
        if(confirm(`${teacherName} ì„ ìƒë‹˜ê»˜ ìƒë‹´ì„ ì‹ ì²­í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
            alert("ìƒë‹´ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ê»˜ì„œ í™•ì¸ í›„ ì—°ë½ì£¼ì‹¤ ê±°ì˜ˆìš”!");
        }
    },

    goToDailyLog: function() {
        this.showPage('student-log');
    },

    renderPhoneOptions: function() {
        const select = document.getElementById('phone-usage');
        for(let i=0; i<=600; i+=30) {
            const hour = Math.floor(i / 60);
            const min = i % 60;
            let text = "";
            if(hour > 0) text += `${hour}ì‹œê°„ `;
            text += `${min}ë¶„`;
            const option = document.createElement('option');
            option.value = i;
            option.text = text;
            select.appendChild(option);
        }
    },

    checkPhoneUsage: function() {
        const time = parseInt(document.getElementById('phone-usage').value);
        if(isNaN(time)) return;

        const feedbackBox = document.getElementById('phone-feedback');
        feedbackBox.classList.remove('hidden');
        
        const avg = this.data.currentUser.avgPhone; // í•™ìƒë³„ í‰ê·  (ê¸°ë³¸ê°’ 180ë¶„)

        if (time < avg) {
            feedbackBox.className = "p-3 rounded-lg text-sm font-bold text-center animate-pulse bg-green-100 text-green-700";
            feedbackBox.innerHTML = `ğŸŒŸ í›Œë¥­í•´ìš”! í‰ê· (${Math.floor(avg/60)}ì‹œê°„)ë³´ë‹¤ ì ê²Œ ì‚¬ìš©í–ˆë„¤ìš”. ìê¸°ì¡°ì ˆ ëŠ¥ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤!`;
        } else {
            feedbackBox.className = "p-3 rounded-lg text-sm font-bold text-center animate-pulse bg-blue-100 text-blue-700";
            feedbackBox.innerHTML = `ğŸ’ª ê´œì°®ì•„ìš”! ë‚´ì¼ì€ ì¡°ê¸ˆ ë” ì¤„ì—¬ë³¼ê¹Œìš”? í•  ìˆ˜ ìˆì–´ìš”!`;
        }
    },

    submitDailyLog: function() {
        const morning = document.getElementById('food-morning').value;
        const dinner = document.getElementById('food-dinner').value;
        const exType = document.getElementById('exercise-type').value;
        const exTime = document.getElementById('exercise-time').value;
        const phone = document.getElementById('phone-usage').value;

        if(!morning || !dinner || !exType || !exTime || !phone) return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        // ë¡œê·¸ ì €ì¥
        const log = {
            date: new Date().toISOString(),
            morning, dinner, exerciseType: exType, exerciseTime: exTime, phone
        };

        // í˜„ì¬ ì‚¬ìš©ì ê°ì²´ ì—…ë°ì´íŠ¸ (ì°¸ì¡°)
        const me = this.data.currentUser;
        me.logs.push(log);
        me.lastActive = Date.now();

        // í¬ì¸íŠ¸ ë¡œì§: ì›” 20íšŒ ì´ìƒ ê¸°ë¡ ì‹œ +100P
        const thisMonth = new Date().getMonth();
        const monthlyCount = me.logs.filter(l => new Date(l.date).getMonth() === thisMonth).length;
        
        let msg = "ì˜¤ëŠ˜ì˜ í™œë™ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!";
        if(monthlyCount === 20) {
            me.points += 100;
            msg += "\nğŸ‰ ì¶•í•˜í•©ë‹ˆë‹¤! ì´ë‹¬ì˜ ê¸°ë¡ 20íšŒ ë‹¬ì„±ìœ¼ë¡œ 100í¬ì¸íŠ¸ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤!";
        }

        // ì „ì²´ ë°ì´í„° ë°°ì—´ ì—…ë°ì´íŠ¸ ë° ì €ì¥
        const userIndex = this.data.users.findIndex(u => u.id === me.id);
        this.data.users[userIndex] = me;
        this.saveData();

        alert(msg);
        
        // ì…ë ¥ ì´ˆê¸°í™” ë° ë©”ì¸ìœ¼ë¡œ ì´ë™
        document.getElementById('food-morning').value = '';
        document.getElementById('food-dinner').value = '';
        document.getElementById('exercise-type').value = '';
        document.getElementById('exercise-time').value = '';
        document.getElementById('phone-usage').value = '';
        document.getElementById('phone-feedback').classList.add('hidden');
        
        this.showPage('student-main');
        this.renderStudentMain(); // í¬ì¸íŠ¸ ë“± ê°±ì‹ 
    }
};

// ì•± ì´ˆê¸°í™” ì‹¤í–‰
app.init();
</script>
</body>
</html>
