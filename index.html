<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ í•™êµ ìƒí™œ ë§¤ë‹ˆì €</title>
    <!-- Tailwind CSS (ìŠ¤íƒ€ì¼ë§) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome (ì•„ì´ì½˜) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background-color: #f3f4f6; }
        
        /* í˜ì´ì§€ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .page { display: none; padding-bottom: 80px; /* í•˜ë‹¨ ì—¬ë°± í™•ë³´ */ }
        .page.active { display: block; animation: slideIn 0.3s ease-in-out; }
        
        @keyframes slideIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .card { background: white; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); padding: 1.5rem; margin-bottom: 1rem; }
        
        /* ìº˜ë¦°ë” ìŠ¤íƒ€ì¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px; background: #e5e7eb; border: 1px solid #e5e7eb; }
        .calendar-cell { background: white; min-height: 60px; padding: 2px; font-size: 0.75rem; position: relative; cursor: pointer; }
        .calendar-cell:hover { background-color: #f9fafb; }
        .calendar-header { background: #f3f4f6; font-weight: bold; text-align: center; padding: 5px 0; font-size: 0.8rem; }
        .event-badge { display: block; border-radius: 2px; padding: 1px 3px; margin-top: 2px; font-size: 0.65rem; color: white; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body class="text-gray-800 antialiased">

    <!-- ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="app" class="max-w-md mx-auto min-h-screen bg-white shadow-2xl relative overflow-hidden flex flex-col">
        
        <!-- í—¤ë” (ê³µí†µ) -->
        <header id="main-header" class="bg-blue-600 text-white p-4 flex justify-between items-center hidden shadow-md sticky top-0 z-40">
            <h1 class="text-lg font-bold cursor-pointer flex items-center gap-2" onclick="app.goHome()">
                <i class="fas fa-school"></i> ìŠ¤ì¿¨ ë¼ì´í”„
            </h1>
            <div class="flex gap-2 items-center">
                <!-- í•™ìƒìš© í¬ì¸íŠ¸/ìƒë‹´ ë²„íŠ¼ ì˜ì—­ -->
                <div id="student-header-controls" class="hidden flex gap-2 items-center">
                    <span class="bg-blue-800 px-2 py-1 rounded text-sm flex items-center">
                        <i class="fas fa-coins text-yellow-300 mr-1"></i> <span id="header-points">0</span> P
                    </span>
                    <button onclick="app.openConsultationModal()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded text-sm font-bold shadow transition">
                        <i class="fas fa-comments mr-1"></i>ìƒë‹´
                    </button>
                </div>
                <!-- ë¡œê·¸ì•„ì›ƒ -->
                <button onclick="app.logout()" class="text-xs bg-blue-800 hover:bg-blue-700 px-3 py-1 rounded transition">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <main class="flex-grow bg-gray-50 overflow-y-auto">

            <!-- 1. ë¡œê·¸ì¸ í˜ì´ì§€ -->
            <div id="page-login" class="page active p-8 flex flex-col justify-center min-h-screen bg-blue-50">
                <div class="text-center mb-12">
                    <div class="inline-block p-4 rounded-full bg-white shadow-lg mb-4">
                        <i class="fas fa-graduation-cap text-5xl text-blue-600"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-1">ìŠ¤ì¿¨ ë§¤ë‹ˆì €</h1>
                    <p class="text-gray-500 text-sm">í•™ìƒê³¼ ì„ ìƒë‹˜ì„ ì‡ëŠ” ìŠ¤ë§ˆíŠ¸í•œ ê³µê°„</p>
                </div>

                <div class="space-y-4">
                    <button onclick="app.showLoginForm('student')" class="w-full bg-white border-2 border-blue-500 text-blue-600 p-4 rounded-xl font-bold text-lg hover:bg-blue-50 transition shadow-sm flex items-center justify-center gap-3">
                        <i class="fas fa-users"></i> í•™ìƒ / êµì‚¬ ë¡œê·¸ì¸
                    </button>
                    <button onclick="app.showAdminLogin()" class="w-full bg-gray-800 text-white p-4 rounded-xl font-bold text-lg hover:bg-gray-700 transition shadow-sm flex items-center justify-center gap-3">
                        <i class="fas fa-user-shield"></i> ê´€ë¦¬ì ë¡œê·¸ì¸
                    </button>
                </div>
            </div>

            <!-- 2. ê´€ë¦¬ì í˜ì´ì§€ -->
            <div id="page-admin" class="page p-4">
                <h2 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2 flex items-center gap-2">
                    <i class="fas fa-cogs text-gray-600"></i> ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
                </h2>
                
                <!-- ê³„ì • ìƒì„± -->
                <div class="card">
                    <h3 class="font-bold text-sm mb-3 text-gray-600">ê³„ì • ë°œê¸‰ ë° ë°°ì •</h3>
                    <div class="space-y-2">
                        <select id="create-role" class="w-full border p-2 rounded bg-gray-50" onchange="app.toggleTeacherSelect()">
                            <option value="student">í•™ìƒ</option>
                            <option value="teacher">êµì‚¬</option>
                        </select>
                        <input type="text" id="create-name" placeholder="ì´ë¦„" class="w-full border p-2 rounded">
                        <input type="text" id="create-id" placeholder="ì•„ì´ë””" class="w-full border p-2 rounded">
                        <input type="password" id="create-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-2 rounded">
                        <select id="assign-teacher" class="w-full border p-2 rounded bg-gray-50">
                            <option value="">ë‹´ë‹¹ êµì‚¬ ì„ íƒ</option>
                            <!-- JSë¡œ êµì‚¬ ëª©ë¡ ë¡œë“œ -->
                        </select>
                        <button onclick="app.createUser()" class="w-full bg-green-600 text-white p-2 rounded font-bold hover:bg-green-700 mt-2">ê³„ì • ìƒì„±</button>
                    </div>
                </div>

                <!-- í•™ì‚¬ ì¼ì •/í‰ê°€ ì—…ë¡œë“œ -->
                <div class="card">
                    <h3 class="font-bold text-sm mb-3 text-gray-600">ì¼ì • ë“±ë¡</h3>
                    <div class="space-y-2">
                        <input type="text" id="notice-content" placeholder="ì¼ì • ì œëª© (ì˜ˆ: ì¤‘ê°„ê³ ì‚¬)" class="w-full border p-2 rounded">
                        <textarea id="notice-desc" placeholder="ìƒì„¸ ì„¤ëª… (ì˜ˆ: 1~3ë‹¨ì›, êµê³¼ì„œ 50pê¹Œì§€)" class="w-full border p-2 rounded h-20 text-sm"></textarea>
                        <div class="flex gap-2">
                            <select id="notice-type" class="border p-2 rounded bg-white">
                                <option value="event">í–‰ì‚¬</option>
                                <option value="exam">í‰ê°€/ê³¼ì œ</option>
                            </select>
                            <input type="date" id="notice-date" class="w-full border p-2 rounded">
                        </div>
                        <button onclick="app.addNotice()" class="w-full bg-blue-500 text-white p-2 rounded font-bold hover:bg-blue-600">ìº˜ë¦°ë” ë“±ë¡</button>
                    </div>
                </div>
            </div>

            <!-- 3. êµì‚¬ í˜ì´ì§€ -->
            <div id="page-teacher" class="page p-4">
                <div class="bg-white p-4 rounded-xl shadow-sm mb-4 flex items-center justify-between">
                    <div>
                        <h2 class="text-xl font-bold text-gray-800">êµë¬´ì‹¤</h2>
                        <p class="text-xs text-gray-500">ì˜¤ëŠ˜ë„ í˜ì°¬ í•˜ë£¨ ë˜ì„¸ìš”!</p>
                    </div>
                    <i class="fas fa-chalkboard-teacher text-3xl text-blue-200"></i>
                </div>

                <!-- ìƒë‹´ ì‹ ì²­ ë‚´ì—­ ì•Œë¦¼ -->
                <div id="teacher-consult-alert" class="hidden bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-4 rounded-r shadow-sm">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <i class="fas fa-bell text-yellow-600 mr-2"></i>
                            <span class="font-bold text-yellow-700">ìƒˆë¡œìš´ ìƒë‹´ ì‹ ì²­ì´ ìˆìŠµë‹ˆë‹¤!</span>
                        </div>
                        <button onclick="app.showConsultationList()" class="text-xs bg-yellow-200 text-yellow-800 px-2 py-1 rounded hover:bg-yellow-300">í™•ì¸í•˜ê¸°</button>
                    </div>
                </div>

                <!-- ì™¸ë¶€ ë§í¬ ë²„íŠ¼ -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <button onclick="alert('ëŒ€í•œë¯¼êµ­ ì¥í•™ ì¬ë‹¨ ë° ì‹œë„ êµìœ¡ì²­ ì¥í•™ ì‚¬ì—… í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.')" class="bg-white border border-indigo-100 text-indigo-700 p-3 rounded-xl font-bold text-sm text-center shadow-sm hover:bg-indigo-50">
                        <i class="fas fa-graduation-cap block text-xl mb-1 text-indigo-500"></i>ì¥í•™ ì‚¬ì—…
                    </button>
                    <a href="tel:16008272" class="bg-white border border-green-100 text-green-700 p-3 rounded-xl font-bold text-sm text-center shadow-sm hover:bg-green-50">
                        <i class="fas fa-phone-alt block text-xl mb-1 text-green-500"></i>ê²½ê¸°ë„ ì˜¨ì½œ
                        <div class="text-[10px] font-normal text-gray-400">1600-8272</div>
                    </a>
                </div>

                <!-- í•™ìƒ ê´€ë¦¬ íƒ­ -->
                <div class="mb-6">
                    <h3 class="font-bold text-lg mb-3 text-gray-700 flex items-center gap-2">
                        <i class="fas fa-user-friends"></i> ìš°ë¦¬ ë°˜ í•™ìƒ ê´€ë¦¬
                    </h3>
                    <div id="student-list" class="space-y-3">
                        <!-- JSë¡œ ë Œë”ë§ -->
                    </div>
                </div>
            </div>

            <!-- 4. í•™ìƒ ë©”ì¸ í˜ì´ì§€ (ìº˜ë¦°ë” í¬í•¨) -->
            <div id="page-student-main" class="page p-4">
                <!-- ì˜¤ëŠ˜ì˜ ë‹¨ì–´/ë¬¸ì¥ -->
                <div class="bg-gradient-to-br from-blue-600 to-purple-600 rounded-2xl p-5 text-white shadow-lg mb-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 -mt-2 -mr-2 w-20 h-20 bg-white opacity-10 rounded-full blur-xl"></div>
                    <div class="relative z-10">
                        <span class="inline-block bg-white bg-opacity-20 rounded-full px-2 py-0.5 text-[10px] mb-2">Today's Pick</span>
                        <div class="flex items-baseline gap-2 mb-1">
                            <h2 id="today-word" class="text-2xl font-bold">Serendipity</h2>
                            <span id="today-meaning" class="text-sm opacity-90">ëœ»ë°–ì˜ ê¸°ì¨</span>
                        </div>
                        <div class="mt-3 pt-3 border-t border-white border-opacity-20">
                             <p id="today-quote" class="text-sm italic opacity-90 font-light">"ë…¸ë ¥ì€ ë°°ì‹ í•˜ì§€ ì•ŠëŠ”ë‹¤."</p>
                        </div>
                    </div>
                </div>

                <!-- ìº˜ë¦°ë” ì„¹ì…˜ -->
                <div class="card !p-0 overflow-hidden">
                    <div class="p-4 border-b flex justify-between items-center bg-gray-50">
                        <h3 class="font-bold text-gray-700"><i class="far fa-calendar-alt mr-1"></i> í•™ì‚¬ ì¼ì •</h3>
                        <span class="text-xs text-gray-500" id="current-month-display">2026.03</span>
                    </div>
                    
                    <!-- ë‹¬ë ¥ ê·¸ë¦¬ë“œ -->
                    <div class="calendar-grid bg-gray-200">
                        <div class="calendar-header text-red-500">ì¼</div>
                        <div class="calendar-header">ì›”</div>
                        <div class="calendar-header">í™”</div>
                        <div class="calendar-header">ìˆ˜</div>
                        <div class="calendar-header">ëª©</div>
                        <div class="calendar-header">ê¸ˆ</div>
                        <div class="calendar-header text-blue-500">í† </div>
                        <!-- ë‚ ì§œ ì…€ë“¤ì´ JSë¡œ ë“¤ì–´ê° -->
                        <div id="calendar-body" class="contents"></div>
                    </div>
                    <div class="p-3 bg-gray-50 text-xs text-gray-500 text-center">
                        * ì¼ì •ì„ í´ë¦­í•˜ë©´ ìƒì„¸ ë‚´ìš©ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>

                <!-- ì•Œì°¬ í•˜ë£¨ ì´ë™ ë²„íŠ¼ -->
                <button onclick="app.goToDailyLog()" class="w-full bg-white border-2 border-blue-100 hover:border-blue-300 text-blue-600 font-bold py-4 rounded-xl shadow-sm text-lg flex items-center justify-center gap-2 transition group">
                    <span>âœï¸ ì•Œì°¬ ë‚˜ì˜ í•˜ë£¨ ê¸°ë¡í•˜ê¸°</span>
                    <i class="fas fa-arrow-right transform group-hover:translate-x-1 transition"></i>
                </button>
            </div>

            <!-- 5. í•™ìƒ ë°ì¼ë¦¬ ë¡œê·¸ -->
            <div id="page-student-log" class="page p-4">
                <div class="flex items-center mb-6 sticky top-0 bg-gray-50 py-2 z-10">
                    <button onclick="app.showPage('student-main')" class="mr-4 w-8 h-8 flex items-center justify-center bg-white rounded-full shadow text-gray-500 hover:text-gray-800">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2 class="text-xl font-bold">ğŸ“ ì•Œì°¬ í•˜ë£¨ ê¸°ë¡</h2>
                </div>

                <!-- ì‹ë‹¨ -->
                <div class="card">
                    <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="bg-orange-100 text-orange-600 p-1.5 rounded-lg"><i class="fas fa-utensils"></i></span> ì‹ë‹¨ ê¸°ë¡
                    </h3>
                    <div class="space-y-3">
                        <input type="text" id="food-morning" placeholder="ğŸ³ ì•„ì¹¨ ë©”ë‰´" class="w-full border-b p-2 bg-transparent focus:outline-none focus:border-blue-500 transition">
                        <input type="text" id="food-dinner" placeholder="ğŸš ì €ë… ë©”ë‰´" class="w-full border-b p-2 bg-transparent focus:outline-none focus:border-blue-500 transition">
                    </div>
                </div>

                <!-- ìš´ë™ -->
                <div class="card">
                    <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="bg-green-100 text-green-600 p-1.5 rounded-lg"><i class="fas fa-running"></i></span> ìš´ë™ ê¸°ë¡
                    </h3>
                    <div class="flex gap-2">
                        <input type="text" id="exercise-type" placeholder="ìš´ë™ ì¢…ë¥˜" class="flex-1 border-b p-2 bg-transparent focus:outline-none focus:border-green-500">
                        <div class="flex items-center w-24 border-b focus-within:border-green-500">
                            <input type="number" id="exercise-time" placeholder="0" class="w-full p-2 bg-transparent text-right focus:outline-none">
                            <span class="text-gray-500 text-sm pr-1">ë¶„</span>
                        </div>
                    </div>
                </div>

                <!-- íœ´ëŒ€í° -->
                <div class="card">
                    <h3 class="font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span class="bg-blue-100 text-blue-600 p-1.5 rounded-lg"><i class="fas fa-mobile-alt"></i></span> í° ì‚¬ìš©ëŸ‰
                    </h3>
                    <select id="phone-usage" class="w-full border p-3 rounded-lg bg-gray-50 mb-3" onchange="app.checkPhoneUsage()">
                        <option value="">ì‚¬ìš© ì‹œê°„ ì„ íƒ</option>
                        <!-- JSë¡œ ì˜µì…˜ ìƒì„± -->
                    </select>
                    <div id="phone-feedback" class="hidden p-3 rounded-lg text-sm font-bold text-center animate-pulse"></div>
                </div>

                <button onclick="app.submitDailyLog()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white p-4 rounded-xl font-bold text-lg shadow-lg transition transform active:scale-95">
                    ê¸°ë¡ ì™„ë£Œ âœ¨
                </button>
            </div>

        </main>

        <!-- [ëª¨ë‹¬] ê³µí†µ: ë¡œê·¸ì¸ -->
        <div id="login-form-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 backdrop-blur-sm px-4">
            <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl transform transition-all">
                <h2 id="login-title" class="text-xl font-bold mb-4 text-center">ë¡œê·¸ì¸</h2>
                <div class="space-y-3">
                    <input type="text" id="login-id" placeholder="ì•„ì´ë””" class="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸" class="w-full border p-3 rounded-lg bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                    <button onclick="app.processLogin()" class="w-full bg-blue-600 text-white p-3 rounded-lg font-bold hover:bg-blue-700">ì ‘ì†í•˜ê¸°</button>
                    <button onclick="document.getElementById('login-form-modal').classList.add('hidden')" class="w-full text-gray-500 text-sm py-2">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <!-- [ëª¨ë‹¬] ê³µí†µ: ì¼ì • ìƒì„¸ ë³´ê¸° -->
        <div id="schedule-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
            <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl relative">
                <button onclick="document.getElementById('schedule-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
                <div id="schedule-modal-badge" class="inline-block px-2 py-1 rounded text-xs text-white bg-gray-500 mb-2">ì¼ì •</div>
                <h3 id="schedule-modal-title" class="text-xl font-bold mb-1">ì œëª©</h3>
                <p id="schedule-modal-date" class="text-sm text-gray-500 mb-4">ë‚ ì§œ</p>
                
                <div class="bg-gray-50 p-4 rounded-lg text-sm text-gray-700 min-h-[100px]">
                    <h4 class="font-bold text-gray-500 text-xs mb-1">ìƒì„¸ ë‚´ìš©/ë²”ìœ„</h4>
                    <p id="schedule-modal-desc">ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
                <button onclick="document.getElementById('schedule-modal').classList.add('hidden')" class="w-full mt-4 bg-gray-100 text-gray-700 p-2 rounded font-bold hover:bg-gray-200">ë‹«ê¸°</button>
            </div>
        </div>

        <!-- [ëª¨ë‹¬] í•™ìƒ: ìƒë‹´ ì‹ ì²­ ì‘ì„± -->
        <div id="consult-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
            <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl">
                <h2 class="text-lg font-bold mb-2">ì„ ìƒë‹˜ê»˜ ìƒë‹´ ì‹ ì²­</h2>
                <p class="text-xs text-gray-500 mb-4">ì„ ìƒë‹˜ê»˜ ì „í•˜ê³  ì‹¶ì€ ê°„ë‹¨í•œ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”.</p>
                <textarea id="consult-content" class="w-full border p-3 rounded-lg mb-4 h-32 resize-none text-sm bg-gray-50 focus:bg-white focus:ring-1 focus:ring-blue-500 outline-none" placeholder="ì˜ˆ: ìˆ˜í–‰í‰ê°€ ì¤€ë¹„ê°€ ì–´ë ¤ì›Œìš”. ì¹œêµ¬ ê´€ê³„ ë•Œë¬¸ì— ê³ ë¯¼ì´ì—ìš”."></textarea>
                <div class="flex gap-2">
                    <button onclick="app.submitConsultation()" class="flex-1 bg-blue-600 text-white p-2 rounded-lg font-bold hover:bg-blue-700">ì‹ ì²­í•˜ê¸°</button>
                    <button onclick="document.getElementById('consult-modal').classList.add('hidden')" class="flex-1 bg-gray-200 text-gray-700 p-2 rounded-lg font-bold hover:bg-gray-300">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        <!-- [ëª¨ë‹¬] êµì‚¬: ìƒë‹´ ì‹ ì²­ ëª©ë¡ -->
        <div id="teacher-consult-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
            <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl relative max-h-[80vh] flex flex-col">
                <button onclick="document.getElementById('teacher-consult-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
                <h2 class="text-lg font-bold mb-4 border-b pb-2">ğŸ“‹ ìƒë‹´ ì‹ ì²­ ëª©ë¡</h2>
                <div id="consult-list" class="overflow-y-auto flex-1 space-y-3 p-1">
                    <!-- JSë¡œ ë Œë”ë§ -->
                </div>
                <button onclick="document.getElementById('teacher-consult-modal').classList.add('hidden')" class="mt-4 w-full bg-gray-100 p-2 rounded text-sm font-bold">ë‹«ê¸°</button>
            </div>
        </div>

        <!-- [ëª¨ë‹¬] êµì‚¬: í•™ìƒ ìƒì„¸ ì •ë³´ -->
        <div id="student-detail-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 px-4">
            <div class="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl relative">
                <button onclick="document.getElementById('student-detail-modal').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
                <h3 id="modal-student-name" class="text-2xl font-bold mb-1">í•™ìƒ ì´ë¦„</h3>
                <p class="text-gray-500 text-sm mb-4">í™œë™ ëŒ€ì‹œë³´ë“œ</p>
                
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <div class="bg-blue-50 p-3 rounded text-center">
                        <div class="text-xs text-gray-500">ëˆ„ì  í¬ì¸íŠ¸</div>
                        <div id="modal-points" class="text-xl font-bold text-blue-600">0 P</div>
                    </div>
                    <div class="bg-green-50 p-3 rounded text-center">
                        <div class="text-xs text-gray-500">ì´ë²ˆ ë‹¬ ê¸°ë¡</div>
                        <div id="modal-log-count" class="text-xl font-bold text-green-600">0 íšŒ</div>
                    </div>
                </div>

                <h4 class="font-bold text-sm mb-2 text-gray-600">ìµœê·¼ í™œë™ ë¡œê·¸</h4>
                <div id="modal-logs" class="bg-gray-50 p-3 rounded h-32 overflow-y-auto text-sm space-y-2 mb-4">
                    <!-- ë¡œê·¸ ë‚´ìš© -->
                </div>

                <button onclick="app.sendWarning()" class="w-full bg-red-100 text-red-600 font-bold py-2 rounded hover:bg-red-200 transition">
                    <i class="fas fa-bell mr-1"></i>í™œë™ ë…ë ¤ ì•Œë¦¼ ë³´ë‚´ê¸°
                </button>
            </div>
        </div>

    </div>

<script>
// ë°ì´í„° ë° ì•± ë¡œì§
const app = {
    data: {
        currentUser: null,
        users: [
            { id: 'teacher1', pw: '1234', name: 'ê¹€êµì‚¬', role: 'teacher', students: [] },
            { id: 'student1', pw: '1234', name: 'ì´í•™ìƒ', role: 'student', teacherId: 'teacher1', points: 150, avgPhone: 180, logs: [], lastActive: Date.now() },
            { id: 'student2', pw: '1234', name: 'ë°•í•™ìƒ', role: 'student', teacherId: 'teacher1', points: 20, avgPhone: 180, logs: [], lastActive: Date.now() - 864000000 }
        ],
        // ì¼ì • ë°ì´í„° (description ì¶”ê°€)
        schedules: [
            { id: 1, date: '2026-03-02', title: 'ê°œí•™ì‹', type: 'event', desc: 'ìƒˆ í•™ê¸° ì‹œì‘! ê°•ë‹¹ìœ¼ë¡œ 9ì‹œê¹Œì§€ ì§‘í•©' },
            { id: 2, date: '2026-03-25', title: 'ì˜ì–´ ë§í•˜ê¸° ìˆ˜í–‰', type: 'exam', desc: 'ì£¼ì œ: ë‚˜ì˜ ê¿ˆ, 3ë¶„ ë°œí‘œ ì¤€ë¹„' },
            { id: 3, date: '2026-04-05', title: 'ìˆ˜í•™ ìª½ì§€ì‹œí—˜', type: 'exam', desc: 'ë²”ìœ„: 1ë‹¨ì› ~ 2ë‹¨ì› ë°©ì •ì‹ê¹Œì§€' }
        ],
        // ìƒë‹´ ë‚´ì—­ ë°ì´í„°
        consultations: [], 
        words: [
            { word: 'Perseverance', mean: 'ì¸ë‚´ì‹¬' },
            { word: 'Integrity', mean: 'ì§„ì‹¤ì„±' },
            { word: 'Empathy', mean: 'ê³µê°' }
        ],
        quotes: [
            "ì²œë¦¬ ê¸¸ë„ í•œ ê±¸ìŒë¶€í„°.",
            "ì‹¤íŒ¨ëŠ” ì„±ê³µì˜ ì–´ë¨¸ë‹ˆì´ë‹¤.",
            "ë„ˆ ìì‹ ì„ ì•Œë¼."
        ]
    },

    init: function() {
        this.renderPhoneOptions();
        
        // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        const savedUsers = localStorage.getItem('schoolAppUsers');
        if (savedUsers) this.data.users = JSON.parse(savedUsers);
        
        const savedSchedules = localStorage.getItem('schoolAppSchedules');
        if (savedSchedules) this.data.schedules = JSON.parse(savedSchedules);

        const savedConsults = localStorage.getItem('schoolAppConsults');
        if (savedConsults) this.data.consultations = JSON.parse(savedConsults);
    },

    saveData: function() {
        localStorage.setItem('schoolAppUsers', JSON.stringify(this.data.users));
        localStorage.setItem('schoolAppSchedules', JSON.stringify(this.data.schedules));
        localStorage.setItem('schoolAppConsults', JSON.stringify(this.data.consultations));
    },

    // í™”ë©´ ì „í™˜
    showPage: function(pageId) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById('page-' + pageId).classList.add('active');
        
        const header = document.getElementById('main-header');
        if(pageId === 'login') {
            header.classList.add('hidden');
        } else {
            header.classList.remove('hidden');
        }
    },

    // ë¡œê·¸ì¸ ë¡œì§
    showAdminLogin: function() {
        const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (1234)");
        if (pw === '1234') {
            this.data.currentUser = { role: 'admin', name: 'ê´€ë¦¬ì' };
            this.renderAdmin();
            this.showPage('admin');
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
    },

    showLoginForm: function() {
        document.getElementById('login-form-modal').classList.remove('hidden');
        document.getElementById('login-id').value = '';
        document.getElementById('login-pw').value = '';
    },

    processLogin: function() {
        const id = document.getElementById('login-id').value;
        const pw = document.getElementById('login-pw').value;
        
        const user = this.data.users.find(u => u.id === id && u.pw === pw);
        
        if (user) {
            this.data.currentUser = user;
            document.getElementById('login-form-modal').classList.add('hidden');
            if (user.role === 'teacher') {
                this.renderTeacher();
                this.showPage('teacher');
            } else {
                this.renderStudentMain();
                this.showPage('student-main');
            }
        } else {
            alert("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
        }
    },

    logout: function() {
        this.data.currentUser = null;
        this.showPage('login');
    },

    goHome: function() {
        if (!this.data.currentUser) return;
        if (this.data.currentUser.role === 'admin') this.showPage('admin');
        else if (this.data.currentUser.role === 'teacher') this.showPage('teacher');
        else this.showPage('student-main');
    },

    // ---------------- ê´€ë¦¬ì ê¸°ëŠ¥ ----------------
    renderAdmin: function() {
        const teacherSelect = document.getElementById('assign-teacher');
        teacherSelect.innerHTML = '<option value="">ë‹´ë‹¹ êµì‚¬ ì„ íƒ</option>';
        this.data.users.filter(u => u.role === 'teacher').forEach(t => {
            teacherSelect.innerHTML += `<option value="${t.id}">${t.name}</option>`;
        });
    },

    toggleTeacherSelect: function() {
        const role = document.getElementById('create-role').value;
        const teacherSelect = document.getElementById('assign-teacher');
        teacherSelect.style.display = role === 'student' ? 'block' : 'none';
    },

    createUser: function() {
        const role = document.getElementById('create-role').value;
        const name = document.getElementById('create-name').value;
        const id = document.getElementById('create-id').value;
        const pw = document.getElementById('create-pw').value;
        const teacherId = document.getElementById('assign-teacher').value;

        if (!name || !id || !pw) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        if (role === 'student' && !teacherId) return alert("í•™ìƒì€ ë‹´ë‹¹ êµì‚¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
        if (this.data.users.some(u => u.id === id)) return alert("ì¤‘ë³µëœ ì•„ì´ë””ì…ë‹ˆë‹¤.");

        const newUser = {
            id, pw, name, role,
            ...(role === 'student' ? { teacherId, points: 0, avgPhone: 180, logs: [], lastActive: Date.now() } : { students: [] })
        };

        this.data.users.push(newUser);
        this.saveData();
        alert('ê³„ì •ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        
        document.getElementById('create-name').value = '';
        document.getElementById('create-id').value = '';
        document.getElementById('create-pw').value = '';
    },

    addNotice: function() {
        const content = document.getElementById('notice-content').value;
        const desc = document.getElementById('notice-desc').value;
        const date = document.getElementById('notice-date').value;
        const type = document.getElementById('notice-type').value;

        if(!content || !date) return alert('ì œëª©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');

        this.data.schedules.push({ 
            id: Date.now(),
            date: date, 
            title: content, 
            desc: desc || "ìƒì„¸ ë‚´ìš© ì—†ìŒ",
            type: type 
        });
        this.saveData();
        alert('ì¼ì •ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        document.getElementById('notice-content').value = '';
        document.getElementById('notice-desc').value = '';
    },

    // ---------------- êµì‚¬ ê¸°ëŠ¥ ----------------
    renderTeacher: function() {
        // í•™ìƒ í—¤ë” ì»¨íŠ¸ë¡¤ ìˆ¨ê¹€ (êµì‚¬ëŠ” ìƒë‹´ ë²„íŠ¼ X)
        document.getElementById('student-header-controls').classList.add('hidden');

        // í•™ìƒ ëª©ë¡ ë Œë”ë§
        const list = document.getElementById('student-list');
        list.innerHTML = '';
        const myStudents = this.data.users.filter(u => u.role === 'student' && u.teacherId === this.data.currentUser.id);

        if (myStudents.length === 0) {
            list.innerHTML = '<p class="text-gray-500 text-center py-4">ë°°ì •ëœ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            myStudents.forEach(s => {
                const isInactive = (Date.now() - (s.lastActive || 0)) > (7 * 24 * 60 * 60 * 1000);
                const warningBadge = isInactive ? `<span class="text-xs bg-red-100 text-red-600 px-1 rounded ml-2 animate-pulse">âš ï¸ í™œë™ ë¯¸í¡</span>` : '';

                const div = document.createElement('div');
                div.className = 'bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center cursor-pointer hover:bg-blue-50 transition';
                div.innerHTML = `
                    <div>
                        <span class="font-bold text-gray-800">${s.name}</span>
                        ${warningBadge}
                    </div>
                    <div class="text-blue-600 font-bold text-sm">${s.points} P</div>
                `;
                div.onclick = () => this.showStudentDetail(s.id);
                list.appendChild(div);
            });
        }

        // ìƒë‹´ ì‹ ì²­ í™•ì¸
        const myConsults = this.data.consultations.filter(c => c.teacherId === this.data.currentUser.id && c.status === 'pending');
        const alertBox = document.getElementById('teacher-consult-alert');
        if (myConsults.length > 0) {
            alertBox.classList.remove('hidden');
        } else {
            alertBox.classList.add('hidden');
        }
    },

    showConsultationList: function() {
        const myConsults = this.data.consultations.filter(c => c.teacherId === this.data.currentUser.id);
        const listDiv = document.getElementById('consult-list');
        listDiv.innerHTML = '';

        if(myConsults.length === 0) {
            listDiv.innerHTML = '<p class="text-center text-gray-500 py-4">ìƒë‹´ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
        } else {
            myConsults.reverse().forEach(c => {
                const student = this.data.users.find(u => u.id === c.studentId);
                const statusClass = c.status === 'pending' ? 'bg-red-100 text-red-600' : 'bg-gray-100 text-gray-500';
                const statusText = c.status === 'pending' ? 'ë¯¸í™•ì¸' : 'ì™„ë£Œ';
                
                const item = document.createElement('div');
                item.className = 'bg-gray-50 p-3 rounded-lg border border-gray-100';
                item.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-bold text-sm">${student ? student.name : 'ì•Œìˆ˜ì—†ìŒ'}</span>
                            <span class="text-xs text-gray-400 ml-1">${new Date(c.date).toLocaleDateString()}</span>
                        </div>
                        <span class="text-xs px-2 py-0.5 rounded-full ${statusClass}">${statusText}</span>
                    </div>
                    <p class="text-sm text-gray-700 bg-white p-2 rounded border border-gray-100 mb-2">${c.content}</p>
                    ${c.status === 'pending' ? `<button onclick="app.completeConsultation(${c.id})" class="w-full bg-blue-500 text-white text-xs py-1.5 rounded font-bold hover:bg-blue-600">ìƒë‹´ í™•ì¸ ì™„ë£Œ</button>` : ''}
                `;
                listDiv.appendChild(item);
            });
        }
        document.getElementById('teacher-consult-modal').classList.remove('hidden');
    },

    completeConsultation: function(consultId) {
        const consult = this.data.consultations.find(c => c.id === consultId);
        if(consult) {
            consult.status = 'completed';
            this.saveData();
            this.showConsultationList(); // ë¦¬ìŠ¤íŠ¸ ê°±ì‹ 
            this.renderTeacher(); // ì•Œë¦¼ ë°°ì§€ ê°±ì‹ 
        }
    },

    showStudentDetail: function(studentId) {
        const student = this.data.users.find(u => u.id === studentId);
        if (!student) return;

        document.getElementById('modal-student-name').innerText = student.name;
        document.getElementById('modal-points').innerText = `${student.points} P`;
        
        const thisMonth = new Date().getMonth();
        const monthlyLogs = student.logs.filter(l => new Date(l.date).getMonth() === thisMonth).length;
        document.getElementById('modal-log-count').innerText = `${monthlyLogs} íšŒ`;

        const logsDiv = document.getElementById('modal-logs');
        logsDiv.innerHTML = student.logs.length ? '' : '<div class="text-center text-gray-400 py-4">ê¸°ë¡ ì—†ìŒ</div>';
        
        [...student.logs].reverse().slice(0, 5).forEach(log => {
            logsDiv.innerHTML += `
                <div class="bg-white p-2 rounded border border-gray-100 mb-1">
                    <span class="text-xs text-gray-400 block">${new Date(log.date).toLocaleDateString()}</span>
                    <span class="text-xs text-gray-800">ğŸƒ ${log.exerciseType} (${log.exerciseTime}ë¶„) / ğŸ“± ${Math.floor(log.phone/60)}h ${log.phone%60}m</span>
                </div>
            `;
        });

        const warnBtn = document.querySelector('#student-detail-modal button[onclick*="sendWarning"]');
        warnBtn.onclick = () => {
            alert(`${student.name} í•™ìƒì—ê²Œ ì•Œë¦¼ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.`);
            document.getElementById('student-detail-modal').classList.add('hidden');
        };

        document.getElementById('student-detail-modal').classList.remove('hidden');
    },

    // ---------------- í•™ìƒ ê¸°ëŠ¥ ----------------
    renderStudentMain: function() {
        // í—¤ë” ë²„íŠ¼ ë³´ì´ê¸°
        document.getElementById('student-header-controls').classList.remove('hidden');
        document.getElementById('header-points').innerText = this.data.currentUser.points;

        // ëœë¤ ë¬¸êµ¬
        const word = this.data.words[Math.floor(Math.random() * this.data.words.length)];
        document.getElementById('today-word').innerText = word.word;
        document.getElementById('today-meaning').innerText = word.mean;
        document.getElementById('today-quote').innerText = `"${this.data.quotes[Math.floor(Math.random() * this.data.quotes.length)]}"`;

        // ìº˜ë¦°ë” ê·¸ë¦¬ê¸° (í˜„ì¬ ë‚ ì§œ ê¸°ì¤€)
        const now = new Date();
        this.renderCalendar(now.getFullYear(), now.getMonth());
    },

    renderCalendar: function(year, month) {
        const container = document.getElementById('calendar-body');
        container.innerHTML = '';
        
        document.getElementById('current-month-display').innerText = `${year}.${String(month + 1).padStart(2, '0')}`;

        const firstDay = new Date(year, month, 1).getDay();
        const lastDate = new Date(year, month + 1, 0).getDate();

        // ë¹ˆ ì¹¸ ì±„ìš°ê¸°
        for(let i=0; i<firstDay; i++) {
            container.innerHTML += `<div class="calendar-cell bg-gray-100 cursor-default"></div>`;
        }

        // ë‚ ì§œ ì±„ìš°ê¸°
        for(let d=1; d<=lastDate; d++) {
            const dateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const schedules = this.data.schedules.filter(s => s.date === dateStr);
            
            let html = `<div class="calendar-cell" onclick="app.clickDate('${dateStr}')">
                <span class="block text-right ${new Date(dateStr).getDay()===0?'text-red-500':''}">${d}</span>`;
            
            schedules.forEach(s => {
                const color = s.type === 'exam' ? 'bg-red-500' : 'bg-blue-500';
                html += `<span class="event-badge ${color}" onclick="event.stopPropagation(); app.showScheduleDetail(${s.id})">${s.title}</span>`;
            });

            html += `</div>`;
            container.innerHTML += html;
        }
    },

    clickDate: function(dateStr) {
        // ë‚ ì§œ í´ë¦­ ì‹œ í•´ë‹¹ ë‚ ì§œ ì¼ì • ë³´ê¸° (ê°„ì†Œí™”)
        const schedules = this.data.schedules.filter(s => s.date === dateStr);
        if(schedules.length === 0) return;
        this.showScheduleDetail(schedules[0].id); // ì²« ë²ˆì§¸ ì¼ì • ë³´ì—¬ì£¼ê¸°
    },

    showScheduleDetail: function(id) {
        const schedule = this.data.schedules.find(s => s.id === id);
        if(!schedule) return;

        const badge = document.getElementById('schedule-modal-badge');
        badge.innerText = schedule.type === 'exam' ? 'í‰ê°€/ê³¼ì œ' : 'í•™ì‚¬ì¼ì •';
        badge.className = `inline-block px-2 py-1 rounded text-xs text-white mb-2 ${schedule.type === 'exam' ? 'bg-red-500' : 'bg-blue-500'}`;
        
        document.getElementById('schedule-modal-title').innerText = schedule.title;
        document.getElementById('schedule-modal-date').innerText = schedule.date;
        document.getElementById('schedule-modal-desc').innerText = schedule.desc;
        
        document.getElementById('schedule-modal').classList.remove('hidden');
    },

    // ìƒë‹´ ì‹ ì²­ (í•™ìƒ)
    openConsultationModal: function() {
        document.getElementById('consult-content').value = '';
        document.getElementById('consult-modal').classList.remove('hidden');
    },

    submitConsultation: function() {
        const content = document.getElementById('consult-content').value;
        if(!content) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const teacherId = this.data.currentUser.teacherId;
        if(!teacherId) return alert("ë°°ì •ëœ êµì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.");

        this.data.consultations.push({
            id: Date.now(),
            studentId: this.data.currentUser.id,
            teacherId: teacherId,
            content: content,
            date: new Date().toISOString(),
            status: 'pending'
        });
        this.saveData();
        alert("ìƒë‹´ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì„ ìƒë‹˜ê»˜ì„œ í™•ì¸í•˜ì‹¤ ê±°ì˜ˆìš”!");
        document.getElementById('consult-modal').classList.add('hidden');
    },

    // ë°ì¼ë¦¬ ë¡œê·¸
    goToDailyLog: function() {
        this.showPage('student-log');
    },

    renderPhoneOptions: function() {
        const select = document.getElementById('phone-usage');
        for(let i=0; i<=600; i+=30) {
            const hour = Math.floor(i / 60);
            const min = i % 60;
            let text = "";
            if(hour > 0) text += `${hour}ì‹œê°„ `;
            text += `${min}ë¶„`;
            const option = document.createElement('option');
            option.value = i;
            option.text = text;
            select.appendChild(option);
        }
    },

    checkPhoneUsage: function() {
        const time = parseInt(document.getElementById('phone-usage').value);
        if(isNaN(time)) return;

        const feedbackBox = document.getElementById('phone-feedback');
        feedbackBox.classList.remove('hidden');
        
        const avg = this.data.currentUser.avgPhone; 

        if (time < avg) {
            feedbackBox.className = "p-3 rounded-lg text-sm font-bold text-center animate-pulse bg-green-100 text-green-700";
            feedbackBox.innerHTML = `ğŸŒŸ í›Œë¥­í•´ìš”! í‰ê· (${Math.floor(avg/60)}h)ë³´ë‹¤ ì ê²Œ ì‚¬ìš©í–ˆë„¤ìš”.`;
        } else {
            feedbackBox.className = "p-3 rounded-lg text-sm font-bold text-center animate-pulse bg-blue-100 text-blue-700";
            feedbackBox.innerHTML = `ğŸ’ª ê´œì°®ì•„ìš”! ë‚´ì¼ì€ ì¡°ê¸ˆ ë” ì¤„ì—¬ë³¼ê¹Œìš”?`;
        }
    },

    submitDailyLog: function() {
        const morning = document.getElementById('food-morning').value;
        const dinner = document.getElementById('food-dinner').value;
        const exType = document.getElementById('exercise-type').value;
        const exTime = document.getElementById('exercise-time').value;
        const phone = document.getElementById('phone-usage').value;

        if(!morning || !dinner || !exType || !exTime || !phone) return alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const log = {
            date: new Date().toISOString(),
            morning, dinner, exerciseType: exType, exerciseTime: exTime, phone
        };

        const me = this.data.currentUser;
        me.logs.push(log);
        me.lastActive = Date.now();

        const thisMonth = new Date().getMonth();
        const monthlyCount = me.logs.filter(l => new Date(l.date).getMonth() === thisMonth).length;
        
        let msg = "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“";
        if(monthlyCount === 20) {
            me.points += 100;
            msg += "\nğŸ‰ ì›” 20íšŒ ê¸°ë¡ ë‹¬ì„±! +100P ì§€ê¸‰!";
        }

        const userIndex = this.data.users.findIndex(u => u.id === me.id);
        this.data.users[userIndex] = me;
        this.saveData();

        alert(msg);
        
        document.getElementById('food-morning').value = '';
        document.getElementById('food-dinner').value = '';
        document.getElementById('exercise-type').value = '';
        document.getElementById('exercise-time').value = '';
        document.getElementById('phone-usage').value = '';
        document.getElementById('phone-feedback').classList.add('hidden');
        
        this.showPage('student-main');
        this.renderStudentMain(); 
    }
};

app.init();
</script>
</body>
</html>
